# プロジェクト名クラスタリングツール ユーザーマニュアル

**バージョン:** 1.0
**対象者:** データ分析担当者、非エンジニア

---

## 目次

1. [このツールについて](#このツールについて)
2. [準備（初回のみ）](#準備初回のみ)
3. [基本的な使い方](#基本的な使い方)
4. [出力ファイルの見方](#出力ファイルの見方)
5. [設定のカスタマイズ](#設定のカスタマイズ)
6. [よくある質問](#よくある質問)
7. [トラブルシューティング](#トラブルシューティング)

---

## このツールについて

### 何ができるの？

このツールは、受注データの「作業名称」の**表記揺れを自動でグループ分け**してくれます。

**例：**
```
入力データ:
- みらい銀行　勘定系システム　第1期開発
- みらい銀行勘定系システム第１期開発
- みらい銀行 勘定系システム 第一期開発

↓ クラスタリング実行 ↓

出力データ:
- みらい銀行　勘定系システム　第1期開発　→ クラスタID: 1, 代表名: みらい銀行勘定系システム第1期開発
- みらい銀行勘定系システム第１期開発　　　→ クラスタID: 1, 代表名: みらい銀行勘定系システム第1期開発
- みらい銀行 勘定系システム 第一期開発　　→ クラスタID: 1, 代表名: みらい銀行勘定系システム第1期開発
```

同じプロジェクトなのに表記が違うデータを、自動的に同じグループにまとめてくれます。

---

## 準備（初回のみ）

### 必要なファイル

ツールを使うには、以下の3つのファイルが必要です：

```
作業フォルダ/
├── clustering.exe    ← 実行ファイル（配布されたもの）
├── config.yaml       ← 設定ファイル（配布されたもの）
└── input.csv         ← あなたが用意する入力データ
```

### ステップ1: フォルダを作る

1. デスクトップや任意の場所に「クラスタリングツール」フォルダを作成
2. 配布された `clustering.exe` と `config.yaml` をコピー

### ステップ2: 入力CSVファイルを準備

**必須の列:**
- `オーダーID` - 受注データのID
- `会社名` - 顧客の会社名
- `作業名称` - クラスタリング対象のプロジェクト名

**入力ファイルの例（input.csv）:**

```csv
オーダーID,会社名,作業名称
ORD001,みらい銀行,勘定系システム第1期開発
ORD002,みらい銀行,勘定系システム　第１期開発
ORD003,東京システム株式会社,人事システムリプレース
ORD004,東京システム株式会社,人事システム　リプレース
```

**重要なポイント:**
- ファイル名は **input.csv** にする（または config.yaml で変更可能）
- エンコーディングは **UTF-8（BOM付き）** または **Shift-JIS**
- 必須列（オーダーID、会社名、作業名称）が必ず存在すること

---

## 基本的な使い方

### 方法1: ダブルクリックで実行（簡単）

1. **input.csv** を作業フォルダに配置
2. **clustering.exe** をダブルクリック
3. 処理が自動的に実行されます
4. 完了すると、出力ファイルが生成されます

```
実行前:
作業フォルダ/
├── clustering.exe
├── config.yaml
└── input.csv

↓ clustering.exe をダブルクリック ↓

実行後:
作業フォルダ/
├── clustering.exe
├── config.yaml
├── input.csv
├── output_clustered_20260209_143022.csv  ← 出力ファイル
└── clustering.log                        ← ログファイル
```

### 方法2: コマンドラインで実行（詳細設定）

**基本コマンド:**
```cmd
clustering.exe
```

**入力ファイルを指定する場合:**
```cmd
clustering.exe --input データ.csv
```

**設定ファイルを指定する場合:**
```cmd
clustering.exe --config カスタム設定.yaml
```

---

## 出力ファイルの見方

### 出力ファイル名

デフォルトでは **タイムスタンプ付き** のファイル名になります：

```
output_clustered_20260209_143022.csv
                ^^^^^^^^^^^^^^^^
                年月日_時分秒
```

### 出力ファイルの内容

元のCSVに、以下の2つの列が追加されます：

| 列名 | 説明 |
|-----|------|
| **クラスタID** | 同じグループに分類されたデータには同じ番号が付く |
| **代表名** | そのグループの代表的な作業名称 |

**例:**

```csv
オーダーID,会社名,作業名称,クラスタID,代表名
ORD001,みらい銀行,勘定系システム第1期開発,1,勘定系システム第1期開発
ORD002,みらい銀行,勘定系システム　第１期開発,1,勘定系システム第1期開発
ORD003,みらい銀行,融資システム改修,2,融資システム改修
ORD004,東京システム株式会社,人事システムリプレース,1,人事システムリプレース
ORD005,東京システム株式会社,人事システム　リプレース,1,人事システムリプレース
```

**ポイント:**
- クラスタIDが **同じ** = 表記揺れだと判断されたもの
- クラスタIDは **会社ごとに独立** して採番される
  - みらい銀行のクラスタID:1 と 東京システムのクラスタID:1 は別物

---

## 設定のカスタマイズ

### config.yaml の編集

`config.yaml` をメモ帳などで開いて、設定を変更できます。

#### 基本設定

```yaml
# 入出力設定
io:
  input_file: ""                    # 空 = 自動検出、または "data.csv" のように指定
  output_prefix: "output_clustered" # 出力ファイルの接頭辞
  add_timestamp: true               # タイムスタンプを付けるか（true/false）
```

**例1: 入力ファイル名を固定したい**
```yaml
io:
  input_file: "受注データ2024.csv"
```

**例2: タイムスタンプをなしにしたい**
```yaml
io:
  add_timestamp: false  # → output_clustered.csv という名前になる
```

#### 前処理のカスタマイズ

```yaml
# テキスト前処理オプション
preprocessing:
  normalize_width: true         # 半角→全角変換
  remove_spaces: true           # スペース削除
  remove_period: true           # 時期情報削除（FY2024、令和6年度など）
  remove_phase: true            # フェーズ情報削除（要件定義、開発など）
  remove_symbols: true          # 記号削除（／、-、【】など）
  normalize_abbreviations: false # 略語正規化（S→システムなど）※日本語では推奨OFF
```

**使い分けのヒント:**

| 設定 | 推奨値 | 理由 |
|-----|--------|------|
| `normalize_width` | `true` | 半角・全角の揺れを統一 |
| `remove_spaces` | `true` | スペースの有無を無視 |
| `remove_period` | `true` | 「FY2024」などの時期情報を除外 |
| `remove_phase` | `true` | 「要件定義」「開発」などのフェーズを除外 |
| `remove_symbols` | `true` | 記号の有無を無視 |
| `normalize_abbreviations` | `false` | 日本語データでは不要（英語略語向け） |

#### クラスタ数の調整

会社ごとに、クラスタの数を調整できます。

```yaml
# クラスタリング設定
clustering:
  company_cluster_settings:
    "みらい銀行": "+2"              # 自動計算値より2つ多くする
    "東京システム株式会社": 7        # 固定で7クラスタ
    "ABC株式会社": "-1"             # 自動計算値より1つ少なくする
```

**調整のタイミング:**
- クラスタが **細かすぎる** → `"-1"` または `"-2"` で減らす
- クラスタが **粗すぎる** → `"+1"` または `"+2"` で増やす
- **固定値で指定** → 数値で指定（例: `7`）

---

## よくある質問

### Q1. 入力ファイルが複数ある場合はどうする？

**A.** 現在は1回の実行で1つのファイルのみ処理できます。

複数ファイルを処理する方法：
1. **方法1:** ファイルごとに実行する
   ```cmd
   clustering.exe --input データ1.csv
   clustering.exe --input データ2.csv
   ```

2. **方法2:** 複数ファイルを1つにまとめてから実行

---

### Q2. クラスタの精度が悪い場合は？

**A.** 以下を試してください：

1. **前処理オプションの調整**
   - `config.yaml` の `preprocessing` セクションを変更

2. **クラスタ数の調整**
   - 特定の会社のクラスタ数を増減

3. **入力データの確認**
   - 必須列（オーダーID、会社名、作業名称）が正しいか
   - 作業名称が空欄になっていないか

---

### Q3. エラーが出た場合はどうする？

**A.** `clustering.log` ファイルを確認してください。

ログファイルには、エラーの詳細情報が記録されています。

---

### Q4. Pythonがインストールされていないけど使える？

**A.** はい、使えます！

`clustering.exe` は **スタンドアロン実行ファイル** なので、Pythonがなくても動作します。

---

### Q5. macOSやLinuxで使える？

**A.** `clustering.exe` はWindows専用です。

macOS/Linuxで使う場合は、Pythonスクリプト版を実行してください：
```bash
python src/main.py
```

---

## トラブルシューティング

### エラー: 「ファイルが見つかりません」

**原因:** 入力CSVファイルが存在しない、またはファイル名が間違っている

**対処法:**
1. `input.csv` が作業フォルダに存在するか確認
2. config.yamlの `input_file` 設定を確認
3. ファイル名のスペルミスを確認

---

### エラー: 「必須列が見つかりません」

**原因:** CSVファイルに必須列（オーダーID、会社名、作業名称）がない

**対処法:**
1. CSVファイルの1行目（ヘッダー行）を確認
2. 列名が **完全一致** しているか確認（全角・半角、スペースも含めて）

**正しい例:**
```csv
オーダーID,会社名,作業名称
ORD001,みらい銀行,システム開発
```

**間違った例:**
```csv
オーダー ID,会社名,作業名  ← スペースが入っている
ORD001,みらい銀行,システム開発
```

---

### エラー: 「文字コードエラー」

**原因:** CSVファイルのエンコーディングが対応していない

**対処法:**
1. Excelで開いて「名前を付けて保存」
2. 「ファイルの種類」で **CSV UTF-8（コンマ区切り）(.csv)** を選択
3. 保存して再実行

---

### 処理が遅い

**原因:** データ量が多い（1000行以上）

**対処法:**
1. 会社ごとにファイルを分割して処理
2. 不要な行を削除してから処理
3. 処理完了まで待つ（バックグラウンドで実行）

---

### 出力ファイルが開けない

**原因:** Excelが古いバージョンで、UTF-8 BOMに対応していない可能性

**対処法:**
1. **メモ帳** で開く → Excelにコピー＆ペースト
2. **Excel 2019以降** を使用（UTF-8 BOM対応）
3. config.yamlで出力エンコーディングを変更（開発者に相談）

---

### ログファイルの見方

`clustering.log` の見方：

```
2026-02-09 14:30:22 - INFO - ========================================
2026-02-09 14:30:22 - INFO - クラスタリング処理を開始します
2026-02-09 14:30:22 - INFO - ========================================
2026-02-09 14:30:23 - INFO - 入力ファイルを読み込みました: input.csv (100行)
2026-02-09 14:30:23 - INFO - 前処理を実行中...
2026-02-09 14:30:24 - INFO - クラスタリングを実行中...
2026-02-09 14:30:25 - INFO - 出力ファイルを保存しました: output_clustered_20260209_143025.csv
2026-02-09 14:30:25 - INFO - 処理が正常に完了しました
```

**エラーが出た場合:**
```
2026-02-09 14:30:23 - ERROR - ファイルが見つかりません: input.csv
2026-02-09 14:30:23 - ERROR - 処理を中断しました
```

→ `ERROR` の行を確認して、原因を特定します。

---

## サンプルデータ

### 入力ファイルのサンプル（input.csv）

```csv
オーダーID,会社名,作業名称
ORD001,みらい銀行,勘定系システム第1期開発
ORD002,みらい銀行,勘定系システム　第１期開発
ORD003,みらい銀行,勘定系システム第一期開発
ORD004,みらい銀行,融資システム改修
ORD005,みらい銀行,融資システム　改修
ORD006,東京システム株式会社,人事システムリプレース
ORD007,東京システム株式会社,人事システム　リプレース
ORD008,東京システム株式会社,給与計算システム開発
ORD009,ABC株式会社,CRMシステム導入
ORD010,ABC株式会社,ＣＲＭシステム導入
```

このサンプルデータを使って、まず動作確認してみることをお勧めします。

---

## お問い合わせ

ご不明な点がある場合は、開発担当者にお問い合わせください。

---

**最終更新:** 2026-02-09
**バージョン:** 1.0
**作成者:** Claude Code (Project Manager)
